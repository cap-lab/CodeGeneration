CXX_FLAGS = -O2 -g -I$(HSIM2_HOME)/include -I$(SYSTEMC)/include
LFLAGS = -L$(HSIM2_HOME)/lib -L$(SYSTEMC)/lib-linux -lhsim2 -lsystemc -lpthread

CXX = g++
TARGET = run
##SUBDIRS

.PHONY: $(SUBDIRS)

all : $(TARGET) $(SUBDIRS)

$(TARGET) : top.o
	$(CXX) -o $@ $^ $(LFLAGS)

$(SUBDIRS): ; @$(MAKE) -C $@

top.o : top.cpp
	$(CXX) -o $@ -c $^ $(CXX_FLAGS)

clean:
	rm -f *.o $(TARGET)
	@for dir in $(SUBDIRS); \
	do \
		($(MAKE) clean -C $$dir); \
	done